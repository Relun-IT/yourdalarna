<script src="//maps.google.com/maps/api/js?key=AIzaSyCqtDEcW-KAkp5E7_DADBNOimpgEDZz1p4"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>

<h2> <%= t ".active_activities" %> </h2>

<section class="row center-xs">
  <section class="col-xs-12 row center-xs">
    <section class="map" id="trip_route_map">
    </section>
  </section>

  <% @trip_route_activities.each do |trip_route_activity| %>
    <section class="col-xs-12 col-md-4 activity-wrapper">
      <section class="activity-header row middle-xs">
        <section style="background-image:
          linear-gradient(
          rgba(0, 0, 0, 0.3),
          rgba(0, 0, 0, 0.3)
          ),
          url('<%= trip_route_activity.activity.image %>');", class="activity">

          <span class="activity-title">
            <%= trip_route_activity.activity.title %>
          </span>
        </section>

        <%= link_to (t ".show_activity"), trip_route_activity.activity %>
      </section>
    </section>
  <% end %>
</section>

<div class="map-div">
  <div id="directions" class="gmap"></div>
</div>

<script>
$(document).on('turbolinks:load', function() {
  var handler = Gmaps.build('Google');
  handler.buildMap({
    provider: {
      zoom: 9,
      center: {lat: 60.4876438, lng: 15.4260946}
    },
    internal: {id: 'directions'}
    }, function(){

    if(navigator.geolocation)
      navigator.geolocation.getCurrentPosition(displayOnMap);
  });

  function displayOnMap(position){
    var marker = handler.addMarker({
      lat: position.coords.latitude,
      lng: position.coords.longitude,
      infowindow: "YOUR LOCATION"
    });
    var jsonCollection = <%= raw @hash.to_json %>;
    var markers = handler.addMarkers(jsonCollection);

    handler.map.centerOn(marker);
  };
});
</script>
